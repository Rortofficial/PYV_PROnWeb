@*@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer localizer
@model Client.Models.Response.ListMasterClearingAdvancePayment
<div class="row">
    <div class="col-12">
        <div style="float:right">
            <h2>@localizer["Employee Clearing Advance"]</h2>
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6"></div>
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Advance Number"]</div>
            <div class="col-8">
                <input type="hidden" value="" id="txtConfirmBookingID" readonly />
                <input type="text" class="form-control" value="@Model.getAdvancePaymentClearings[0].WebID" id="txtAdvanceNumber" readonly>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <h5>
            <u>CUSTOMER DATA</u>
        </h5>
    </div>
</div>
<div class="row">
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Customer Code"]</div>
            <div class="col-8">
                <input type="text" class="form-control" value="@Model.getAdvancePaymentClearings[0].EmployeeCode" id="txtCardCode" disabled />
            </div>
        </div>
    </div>
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Sereis"]</div>
            <div class="col-8">
                <input type="text" class="form-control" value="@Model.getSeries[0].Name" data-code="@Model.getSeries[0].Code" id="txtSeries" disabled />
            </div>
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Customer Name"]</div>
            <div class="col-8">
                <input type="text" class="form-control" value="@Model.getAdvancePaymentClearings[0].EmployeeName" id="txtCardName" disabled />
            </div>
        </div>
    </div>
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Document Number"]</div>
            <div class="col-8">
                <input type="text" class="form-control" value="@(DateTime.Now.Day.ToString()
                                            + DateTime.Now.Month.ToString()
                                            + DateTime.Now.Year.ToString()
                                            + DateTime.Now.DayOfYear.ToString()
                                            + DateTime.Now.Hour.ToString()
                                            + DateTime.Now.Minute.ToString()
                                            + DateTime.Now.Second.ToString()
                                            + DateTime.Now.Millisecond.ToString())" id="txtWebId" disabled />
            </div>
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Project Number"]</div>
            <div class="col-8">
                <input type="text" class="form-control" value="@Model.getAdvancePaymentClearings[0].ProjectNum" id="txtProjectNum" disabled />
            </div>
        </div>
    </div>
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Posting Date"]</div>
            <div class="col-8">
                <input type="text" class="form-control" value="@DateTime.Now.ToString("dd-MM-yyyy")" id="txtPostingDate" disabled />
            </div>
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-12">
        <h5>
            <u>ADVANCE PAYMENT DATA</u>
        </h5>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Account Number"]</div>
            <div class="col-8">
                <input type="text" class="form-control" value="@Model.getAdvancePaymentClearings[0].AccountCode" id="txtAccountCode" disabled />
            </div>
        </div>
    </div>
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Account Name"]</div>
            <div class="col-8">
                <input type="text" class="form-control" value="@Model.getAdvancePaymentClearings[0].AccountName" id="txtAccountName" disabled />
            </div>
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Total"]</div>
            <div class="col-8">
                <input type="number" class="form-control" value="@Model.getAdvancePaymentClearings[0].Total" id="txtTotal" disabled />
            </div>
        </div>
    </div>
    <div class="col-6">
    </div>
</div>
<div class="row">
    <div class="col-12">
        <h5>
            <u>CLEARING TYPE DATA</u>
        </h5>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Clearing Type"]</div>
            <div class="col-8">
                <select class="form-control" multiple="multiple" id="cboTypeClearing">
                    @foreach(var z in Model.getClearingAdvances)
                    {
                        <option value="@z.ClearingCode" data-accountCode="@z.AccountName">@z.ClearingName</option>
                    }
                </select>
            </div>
        </div>
    </div>
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Account Name"]</div>
            <div class="col-8">
                <input type="text" class="form-control" id="txtAccountClearingName" disabled />
            </div>
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Amount Due"]</div>
            <div class="col-8">
                <input type="number" class="form-control" id="txtAmountDue"/>
            </div>
        </div>
    </div>
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:left;font-weight:bold;">@localizer["Vocher No"]</div>
            <div class="col-8">
                <input type="text" class="form-control" id="txtVoucherNo"/>
            </div>
        </div>
    </div>
</div>
<div class="row mt-3">
    <div class="col-6">
    </div>
    <div class="col-6">
        <button class="btn" id="btnAddLineInfo" style="float:right;background-color:#01295C;color:white">Add Line</button>
    </div>
</div>
<div class="row mt-3">
    <div class="col-12">
        <table id="TbListLineSalesQuotation" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0" style="background: #f0eff1; color: #696969;">
            <thead>
                <tr>
                    <th>Clearing Type</th>
                    <th>Account Name</th>
                    <th>Amount Due</th>
                    <th>Voucher No</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6">
    </div>
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:right;font-weight:bold;">@localizer["Total Advance"]</div>
            <div class="col-8">
                <input type="number" disabled class="form-control" id="txtTotalAdvancePayment" value="@Model.getAdvancePaymentClearings[0].Total" />
            </div>
        </div>
    </div>
</div>
<div class="row mt-2">
    <div class="col-6">
    </div>
    <div class="col-6">
        <div class="row">
            <div class="col-4" style="margin:auto;text-align:right;font-weight:bold;">@localizer["Total Clearing"]</div>
            <div class="col-8">
                <input type="number" disabled class="form-control" id="txtTotalClearing" value="0" />
            </div>
        </div>
    </div>
</div>
<div class="row mt-4">
    <div class="col-6">
    </div>
    <div class="col-6">
        <button class="btn" id="btnConfirmTransaction" onclick="" style="float:right;background-color:#01295C;color:white">Confirm Transaction</button>
    </div>
</div>
@section scripts{
    <script>
        var id=1;
        var listClearingAdvanceLine=[];
        //Clearing Type
        $("#cboTypeClearing").select2({
            placeholder: "Select a Clearing",
            maximumSelectionLength: 1
        });
        $("#cboTypeClearing").change(function(){
            $("#txtAccountClearingName").val($("#cboTypeClearing option:selected").attr("data-accountcode"));
        });
        $('#TbListLineSalesQuotation').DataTable({
            columns:
                [
                    { data: "ClearingType", autoWidth: true },
                    { data: "AccountName", autoWidth: true },
                    { data: "AmountDue", autoWidth: true },
                    { data: "VoucherNo", autoWidth: true },
                    {
                        render: function (data, type, full, meta) {
                            return '<button class="btn-sm btn-danger" style="margin-left: 40%;" onClick="DeleteLineItem(' + full.ID + ')"><i class="fas fa-trash-alt"></i></button>';
                        }
                    }
                ],
        });
        $("#btnAddLineInfo").click(function(){
            var totalClearing = parseFloat($("#txtTotalClearing").val()) + parseFloat($("#txtAmountDue").val());
            var total = parseFloat($("#txtTotal").val()) - totalClearing;
            console.log(totalClearing);
            console.log($("#txtTotal").val());
            console.log(total);
            if (total < 0) {
                alert("Total Clearing Advance is fully or equal with Total Advance Payment");
                return;
            }
            if ($("#txtVoucherNo").val() === "") {
                alert("Voucher No number Require");
                return;
            }
            console.log($("#cboTypeClearing").val().length);
            if ($("#cboTypeClearing").val().length <= 0) {
                alert("Clearing type Require");
                return;
            }
            $("#txtTotalAdvancePayment").val(total);
            $("#txtTotalClearing").val(totalClearing);
            var objline={};
            objline.ClearingType = $("#cboTypeClearing option:selected").text();
            objline.CreditMethodCode = $("#cboTypeClearing").val()[0];
            objline.AccountName = $("#txtAccountClearingName").val();
            objline.AmountDue = $("#txtAmountDue").val();
            objline.VoucherNo = $("#txtVoucherNo").val();
            objline.ID=id;
            listClearingAdvanceLine.push(objline);
            id++;
            reRenderTable();
            $("#cboTypeClearing").val([]).trigger("change");
            $("#txtAccountClearingName").val("");
            $("#txtAmountDue").val(0);
            $("#txtVoucherNo").val("");
        });
        function reRenderTable(){
            var tbListItemLine = $('#TbListLineSalesQuotation').DataTable();
            tbListItemLine.clear();
            tbListItemLine.rows.add(listClearingAdvanceLine);
            tbListItemLine.search("").columns().search("").draw();
        }
        function DeleteLineItem(id) {
            listClearingAdvanceLine = listClearingAdvanceLine.filter(e => e.ID !== id);
            reRenderTable();
        }
        $("#btnConfirmTransaction").click(function(){
            if (listClearingAdvanceLine.length<=0) {
                alert("Clearing Type is require!");
                return;
            }
            if (confirm("Please confirm transaction make the data is correct !")){
                var obj={};
                obj.CardCode = '@Model.getAdvancePaymentClearings[0].EmployeeCode';
                obj.SeriesCode = '@Model.getSeries[0].Code';
                obj.DocDate = $("#txtPostingDate").val();
                obj.WebId = $("#txtWebId").val();
                obj.TransId = @Model.getAdvancePaymentClearings[0].DocEntry;
                obj.Total = @Model.getAdvancePaymentClearings[0].Total;
                obj.DocLine = @Model.getAdvancePaymentClearings[0].DocLine;
                obj.Lines = listClearingAdvanceLine;
                console.log(obj);
                $.ajax({
                    url: '@Url.Action("PostEmployeeClearingAdvancePayment","AdvancePayment")',
                    type: "POST",
                    data: { employeeClearingAdvanceRequest: obj },
                    dataType: "JSON",
                    beforeSend: function () {
                        $('#Modalloder').modal('show');
                    },
                    success: function (data) {
                        $('#Modalloder').modal('hide');
                        $('#ModalSuccess').modal('show');
                        $('#ErrMsg').html("Success");
                        window.location.href = '@Url.Action("ListEmployeeClearingAdvancePayment","AdvancePayment")';
                    },
                    error: function (erro) {
                        $('#Modalloder').modal('hide');
                        $('#ModalSuccess').modal('show');
                        $('#ErrMsg').html(erro.responseText);
                    }
                });
            }
        });
    </script>
}*@